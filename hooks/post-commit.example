#!/bin/bash
#
# Client-side git post-commit hook for automatic LXR-style HTML documentation generation
#
# Installation:
#   1. Copy this file to .git/hooks/post-commit
#   2. Make it executable: chmod +x .git/hooks/post-commit
#   3. Adjust paths below to match your setup
#
# This hook runs AFTER you commit locally, generating updated HTML docs

# Configuration
SOLUTION_FILE="CSharpCallGraphAnalyzer.sln"
HTML_OUTPUT_DIR="docs/html"
ANALYZER_PATH="./CSharpCallGraphAnalyzer/bin/Release/net8.0/csharp-analyzer"

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}[Post-Commit Hook] Generating HTML documentation...${NC}"

# Check if analyzer exists
if [ ! -f "$ANALYZER_PATH" ]; then
    echo "Warning: Analyzer not found at $ANALYZER_PATH"
    echo "Build the analyzer first with: dotnet build -c Release"
    exit 0  # Don't fail the commit
fi

# Generate HTML documentation
$ANALYZER_PATH analyze \
    --solution "$SOLUTION_FILE" \
    --format html \
    --output "$HTML_OUTPUT_DIR" \
    2>&1 | grep -v "^Loading" | grep -v "^Analyzing"

if [ $? -eq 0 ] || [ $? -eq 1 ]; then
    echo -e "${GREEN}âœ“ HTML documentation generated at $HTML_OUTPUT_DIR${NC}"
    echo -e "  Open: file://$(pwd)/$HTML_OUTPUT_DIR/index.html"
else
    echo "Warning: Documentation generation failed (non-critical)"
fi

exit 0  # Always exit 0 so commit isn't affected
